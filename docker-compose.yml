version: "3.7"

services:

  ## --------------------------- CAIO CORP --------------------------- ##

  caio-dashboard:
    image: gleissonsantos/caio-dashboard:latest ## Dashboard React + Nginx

    networks:
      - ControllNet ## Nome da rede interna

    deploy:
      mode: replicated
      replicas: 1
      placement:
        constraints:
          - node.role == manager
      labels:
        - traefik.enable=true
        - traefik.http.routers.caio-dashboard.rule=Host(`agentecaio.controllserv.com.br`)
        - traefik.http.routers.caio-dashboard.entrypoints=websecure
        - traefik.http.routers.caio-dashboard.priority=1
        - traefik.http.routers.caio-dashboard.tls.certresolver=letsencryptresolver
        - traefik.http.routers.caio-dashboard.service=caio-dashboard
        - traefik.http.services.caio-dashboard.loadbalancer.server.port=80
        - traefik.http.services.caio-dashboard.loadbalancer.passHostHeader=true

  ## --------------------------- CAIO CORP --------------------------- ##

  caio-agent:
    image: gleissonsantos/caio-agent:latest ## Core do Agente IA
    command: [ "gateway" ] ## Inicia o bot Telegram (override do CMD status)

    volumes:
      - caio_workspace:/app/workspace
      - /root/Caio-Corp/config.json:/root/.nanobot/config.json ## Caminho correto que o nanobot lÃª

    networks:
      - ControllNet ## Nome da rede interna

    environment:
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - TELEGRAM_BOT_TOKEN=${TELEGRAM_BOT_TOKEN}
      - BRAVE_API_KEY=${BRAVE_API_KEY}

    deploy:
      mode: replicated
      replicas: 1
      placement:
        constraints:
          - node.role == manager

## --------------------------- CAIO CORP --------------------------- ##

volumes:
  caio_workspace:
    external: true
    name: caio_workspace

networks:
  ControllNet:
    ## Nome da rede interna
    external: true
    name: ControllNet ## Nome da rede interna
